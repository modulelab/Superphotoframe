# USBè‡ªå‹•ãƒžã‚¦ãƒ³ãƒˆè¨­å®šã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

é…å¸ƒè£½å“ã¨ã—ã¦ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼åã«ä¾å­˜ã—ãªã„**USBè‡ªå‹•ãƒžã‚¦ãƒ³ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

## ä»•çµ„ã¿

### å›ºå®šãƒžã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆ
- **USBãƒ¡ãƒ¢ãƒªã¯å¸¸ã« `/mnt/usb` ã«ãƒžã‚¦ãƒ³ãƒˆ**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒä½•ã§ã‚ã£ã¦ã‚‚åŒã˜ãƒ‘ã‚¹ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒã§ã‚‚å•é¡Œãªã—

### udevãƒ«ãƒ¼ãƒ«ã«ã‚ˆã‚‹è‡ªå‹•ãƒžã‚¦ãƒ³ãƒˆ
USBãƒ¡ãƒ¢ãƒªã‚’æŒ¿å…¥ã™ã‚‹ã¨è‡ªå‹•çš„ã«ä»¥ä¸‹ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

1. ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºï¼ˆä¾‹ï¼š`/dev/sda1`ï¼‰
2. ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ åˆ¤å®šï¼ˆexFAT, VFAT, NTFS, ext4ãªã©ï¼‰
3. `/mnt/usb` ã«ãƒžã‚¦ãƒ³ãƒˆ
4. é©åˆ‡ãªæ¨©é™è¨­å®šï¼ˆèª­ã¿æ›¸ãå¯èƒ½ï¼‰

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæŽ¨å¥¨ï¼‰

```bash
cd /home/jd/raspiframe
./setup_dlna.sh
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒä»¥ä¸‹ã‚’è‡ªå‹•å®Ÿè¡Œï¼š
- `/mnt/usb` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
- ãƒžã‚¦ãƒ³ãƒˆ/ã‚¢ãƒ³ãƒžã‚¦ãƒ³ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- udevãƒ«ãƒ¼ãƒ«ã®è¨­å®š
- æ—¢å­˜USBã®å†ãƒžã‚¦ãƒ³ãƒˆ

### æ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. ãƒžã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆä½œæˆ
sudo mkdir -p /mnt/usb
sudo chmod 777 /mnt/usb

# 2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo cp usb-mount.sh /usr/local/bin/
sudo cp usb-unmount.sh /usr/local/bin/
sudo chmod +x /usr/local/bin/usb-*.sh

# 3. udevãƒ«ãƒ¼ãƒ«ã‚’è¨­å®š
sudo cp 99-usb-mount.rules /etc/udev/rules.d/
sudo udevadm control --reload-rules
sudo udevadm trigger
```

## ä½¿ã„æ–¹

### 1. USBãƒ¡ãƒ¢ãƒªã‚’æº–å‚™

```
USB/
â”œâ”€â”€ Photo/              # å†™çœŸãƒ•ã‚©ãƒ«ãƒ€
â”‚   â”œâ”€â”€ 2023/
â”‚   â”‚   â”œâ”€â”€ IMG_001.jpg
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ 2024/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ wifi.txt           # WiFiè¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â””â”€â”€ credentials.txt    # NASèªè¨¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```

### 2. USBã‚’æŒ¿å…¥

è‡ªå‹•çš„ã« `/mnt/usb` ã«ãƒžã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ï¼š

```bash
# ç¢ºèª
ls /mnt/usb
# â†’ Photo  wifi.txt  credentials.txt

ls /mnt/usb/Photo
# â†’ 2023  2024
```

### 3. Raspiframeã§ä½¿ç”¨

1. è¨­å®šç”»é¢ã‚’é–‹ã
2. ã€ŒCHECK USB PHOTOã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€Œâœ… FOUND: X images in /mnt/usb/Photoã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹
4. ã€Œï¼‹ ADD TO SELECTIONã€ã§è¿½åŠ 
5. ã€ŒSAVEã€ã§ä¿å­˜

## å¯¾å¿œãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 

âœ… **å®Œå…¨ã‚µãƒãƒ¼ãƒˆ:**
- exFATï¼ˆæŽ¨å¥¨ï¼‰
- FAT32 (VFAT)
- NTFS
- ext2/ext3/ext4

âš ï¸ **åˆ¶é™ã‚ã‚Š:**
- HFS+ï¼ˆmacOSï¼‰: èª­ã¿å–ã‚Šå°‚ç”¨ã®å ´åˆã‚ã‚Š

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### USBãŒèªè­˜ã•ã‚Œãªã„

```bash
# ãƒ‡ãƒã‚¤ã‚¹ç¢ºèª
lsblk
# â†’ sda1ãªã©ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹

# ãƒžã‚¦ãƒ³ãƒˆçŠ¶æ…‹ç¢ºèª
mount | grep /mnt/usb

# æ‰‹å‹•ãƒžã‚¦ãƒ³ãƒˆ
sudo /usr/local/bin/usb-mount.sh sda1
```

### æ¨©é™ã‚¨ãƒ©ãƒ¼

```bash
# æ¨©é™ç¢ºèª
ls -la /mnt/usb

# æ¨©é™ä¿®æ­£
sudo chmod 777 /mnt/usb
```

### udevãƒ«ãƒ¼ãƒ«ãŒå‹•ä½œã—ãªã„

```bash
# ãƒ«ãƒ¼ãƒ«ç¢ºèª
cat /etc/udev/rules.d/99-usb-mount.rules

# ãƒ«ãƒ¼ãƒ«å†èª­ã¿è¾¼ã¿
sudo udevadm control --reload-rules
sudo udevadm trigger

# ãƒ­ã‚°ç¢ºèª
journalctl -f | grep usb
```

### åˆ¥ã®ãƒžã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã«å‹æ‰‹ã«ãƒžã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹

ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç’°å¢ƒï¼ˆLXDEç­‰ï¼‰ã®è‡ªå‹•ãƒžã‚¦ãƒ³ãƒˆæ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ï¼š

```bash
# PCManFMã®è‡ªå‹•ãƒžã‚¦ãƒ³ãƒˆã‚’ç„¡åŠ¹åŒ–
mkdir -p ~/.config/pcmanfm/LXDE-pi
cat > ~/.config/pcmanfm/LXDE-pi/pcmanfm.conf << 'EOF'
[volume]
mount_on_startup=0
mount_removable=0
autorun=0
EOF
```

## é…å¸ƒæ™‚ã®æ³¨æ„

### âœ… ãƒ¡ãƒªãƒƒãƒˆ
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼åéžä¾å­˜**: ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚ `/mnt/usb` ã§çµ±ä¸€
- **ç°¡å˜**: USBã‚’æŒ¿ã™ã ã‘ã§è‡ªå‹•ãƒžã‚¦ãƒ³ãƒˆ
- **äº’æ›æ€§**: ä¸»è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«å¯¾å¿œ

### âš ï¸ æ³¨æ„ç‚¹
- **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¿…é ˆ**: `setup_dlna.sh` ã®å®Ÿè¡ŒãŒå¿…è¦
- **rootæ¨©é™**: ãƒžã‚¦ãƒ³ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯rootæ¨©é™ã§å®Ÿè¡Œ
- **å˜ä¸€USB**: è¤‡æ•°USBåŒæ™‚æŒ¿å…¥ã«ã¯éžå¯¾å¿œï¼ˆæœ€åˆã®USBã®ã¿ï¼‰

## æŠ€è¡“è©³ç´°

### udevãƒ«ãƒ¼ãƒ« (`99-usb-mount.rules`)
```
ACTION=="add", KERNEL=="sd[a-z][0-9]", SUBSYSTEMS=="usb", RUN+="/usr/local/bin/usb-mount.sh %k"
ACTION=="remove", KERNEL=="sd[a-z][0-9]", SUBSYSTEMS=="usb", RUN+="/usr/local/bin/usb-unmount.sh %k"
```

### ãƒžã‚¦ãƒ³ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ (`usb-mount.sh`)
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹•åˆ¤å®šï¼ˆ`blkid`ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™è¨­å®šï¼ˆ`uid=1000,gid=1000`ï¼‰
- ãƒžã‚¦ãƒ³ãƒˆæ¸ˆã¿ãƒã‚§ãƒƒã‚¯ï¼ˆ`mountpoint`ï¼‰

### ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œå‡º (`main.py`)
udevãƒ«ãƒ¼ãƒ«ãŒå‹•ä½œã—ãªã„ç’°å¢ƒã§ã‚‚ã€ä»¥ä¸‹ã®é †ã§æ¤œç´¢ï¼š
1. `/mnt/usb`ï¼ˆæœ€å„ªå…ˆï¼‰
2. `/media/usb`
3. `/media/pi`
4. `/media/*/ä»»æ„ã®ãƒ‡ãƒã‚¤ã‚¹`ï¼ˆå…¨ã‚¹ã‚­ãƒ£ãƒ³ï¼‰

## ã¾ã¨ã‚

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€**ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒã§ã‚‚**ï¼š
- USBã‚’æŒ¿ã™ã ã‘ã§ `/mnt/usb` ã«è‡ªå‹•ãƒžã‚¦ãƒ³ãƒˆ
- Photoãƒ•ã‚©ãƒ«ãƒ€ãŒè‡ªå‹•æ¤œå‡ºã•ã‚Œã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®é•ã„ã‚’æ°—ã«ã™ã‚‹å¿…è¦ãªã—

é…å¸ƒè£½å“ã¨ã—ã¦æœ€é©ãªè¨­è¨ˆã§ã™ï¼ðŸŽ‰

